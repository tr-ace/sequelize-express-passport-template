[The original project](https://github.com/passport/todos-express-facebook) demonstrates how to use [Express](https://expressjs.com) 4.x and
[Passport](https://www.passportjs.org) to log users in with [Facebook](https://www.facebook.com).


As an addition to [the original project](https://github.com/passport/todos-express-facebook), [todos-express-facebook](https://github.com/passport/todos-express-facebook) has been modified to use [Sequelize](https://sequelize.org/) and [passport-facebook](https://www.passportjs.org/packages/passport-facebook/).

Use this example as a starting point for your own web applications, if you're trying to use: [NodeJS](https://nodejs.org/en/), [Express](https://expressjs.com), [Passport](https://www.passportjs.org), [MySQL](https://www.mysql.com/), and [Sequelize](https://www.sequelize.org).

## Quick Start

To get started with this example, clone the repository and install the
dependencies.

```bash
$ git clone https://github.com/tr-ace/sequelize-express-passport-template.git
$ cd sequelize-express-passport-template
$ npm install
```

This example requires credentials from Facebook, which can be obtained by
[creating](https://developers.facebook.com/docs/development/create-an-app) an
app in the [App Dashboard](https://developers.facebook.com/apps).
The OAuth redirect URI of the app should be set to: `http://localhost:3000/oauth2/redirect/www.facebook.com`

Once credentials have been obtained, create a `.env` file and add the following
environment variables:

```
FACEBOOK_CLIENT_ID={{INSERT_APP_ID_HERE}}
FACEBOOK_CLIENT_SECRET={{INSERT_APP_SECRET_HERE}}
DB_HOST={{INSERT_DB_IP_ADDRESS_HERE}}
DB_NAME={{INSERT_DB_NAME_HERE}}
DB_USER={{INSERT_DB_USERNAME_HERE}}
DB_PASSWORD={{INSERT_DB_PASSWORD_HERE (IF ONE EXISTS)}}
```

Start the server.

```bash
$ npm start
```

Navigate to [`http://localhost:3000`](http://localhost:3000).

## Overview

This example illustrates how to use [Passport](https://www.passportjs.org) and
the [`passport-facebook`](https://www.passportjs.org/packages/passport-facebook/)
strategy within an [Express](https://expressjs.com) application to log users in
with [Facebook](https://www.facebook.com).

The example builds upon the scaffolding created by [Express generator](https://expressjs.com/en/starter/generator.html),
and uses [EJS](https://ejs.co) as a view engine and plain CSS for styling.  This
scaffolding was generated by executing:

```
$ express --view ejs express-4.x-facebook-example
```

The example uses [Sequelize](https://www.sequelize.org) and [MySQL](https://www.mysql.com/) for storing user accounts and the to-do data.
MySQL is a free and commonly used database for development and production environments.

Added to the scaffolding are files which add authentication to the application.

* [`/db.js`](./db.js)

  This file initializes the database connection.

* [`routes/auth.js`](routes/auth.js)

  This file initializes Passport.  It configures the Facebook strategy and
  supplies the serialization functions used for session management.

* [`routes/auth.js`](routes/auth.js)

  This file defines the routes used for authentication.  In particular, there
  are three routes used to authenticate with Facebook:
  
  - `GET /login`
  
    This route renders a page that prompts the user to login with Facebook.
  
  - `GET /login/federated/www.facebook.com`
  
    This route begins the authentication sequence by redirecting the user to
    Facebook.
  
  - `POST /oauth2/redirect/www.facebook.com`
  
    This route completes the authentication sequence when Facebook redirects the
    user back to the application.  When a new user logs in, a user account is
    automatically created and their Facebook account is linked.  When an
    existing user returns, they are logged in to their linked account.

## License

[The Unlicense](https://opensource.org/licenses/unlicense)
